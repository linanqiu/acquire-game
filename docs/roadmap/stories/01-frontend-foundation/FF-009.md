# FF-009: Toast System

## Metadata
- **Epic**: Frontend Foundation
- **Status**: `not-started`
- **Priority**: `medium`
- **Effort**: `S` (30-60 minutes)
- **Dependencies**: FF-005, FF-006

## Context

Create a toast notification system for temporary feedback messages. Used for trade notifications, errors, game events, and status updates.

## Requirements

1. Toast component with message and type (info, success, warning, error)
2. ToastProvider context for global toast management
3. Auto-dismiss after configurable duration
4. Manual dismiss option
5. Stack multiple toasts
6. Slide in/out animation

## Acceptance Criteria

- [ ] Toast renders with correct styling per type
- [ ] Toasts auto-dismiss after duration (default 5s)
- [ ] Toasts can be manually dismissed
- [ ] Multiple toasts stack vertically
- [ ] `useToast()` hook provides `toast()` function
- [ ] Slide animation on enter/exit
- [ ] Icons for each toast type
- [ ] Unit tests for toast behavior

## Implementation Notes

### Files to Create

**frontend/src/components/ui/Toast.tsx**:
```tsx
import styles from './Toast.module.css'

interface ToastProps {
  id: string
  message: string
  type: 'info' | 'success' | 'warning' | 'error'
  onDismiss: (id: string) => void
}

const icons = {
  info: 'ℹ',
  success: '✓',
  warning: '⚠',
  error: '✕',
}

export function Toast({ id, message, type, onDismiss }: ToastProps) {
  return (
    <div className={`${styles.toast} ${styles[type]}`}>
      <span className={styles.icon}>{icons[type]}</span>
      <span className={styles.message}>{message}</span>
      <button className={styles.dismiss} onClick={() => onDismiss(id)}>
        ×
      </button>
    </div>
  )
}
```

**frontend/src/components/ui/ToastProvider.tsx**:
```tsx
import { createContext, useContext, useState, useCallback } from 'react'
import { Toast } from './Toast'
import styles from './Toast.module.css'

interface ToastData {
  id: string
  message: string
  type: 'info' | 'success' | 'warning' | 'error'
}

interface ToastContextValue {
  toast: (message: string, type?: ToastData['type'], duration?: number) => void
}

const ToastContext = createContext<ToastContextValue | null>(null)

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const [toasts, setToasts] = useState<ToastData[]>([])

  const removeToast = useCallback((id: string) => {
    setToasts((prev) => prev.filter((t) => t.id !== id))
  }, [])

  const toast = useCallback(
    (message: string, type: ToastData['type'] = 'info', duration = 5000) => {
      const id = Math.random().toString(36).slice(2)
      setToasts((prev) => [...prev, { id, message, type }])

      if (duration > 0) {
        setTimeout(() => removeToast(id), duration)
      }
    },
    [removeToast]
  )

  return (
    <ToastContext.Provider value={{ toast }}>
      {children}
      <div className={styles.container}>
        {toasts.map((t) => (
          <Toast key={t.id} {...t} onDismiss={removeToast} />
        ))}
      </div>
    </ToastContext.Provider>
  )
}

export function useToast() {
  const context = useContext(ToastContext)
  if (!context) {
    throw new Error('useToast must be used within ToastProvider')
  }
  return context
}
```

**frontend/src/components/ui/Toast.module.css**:
```css
.container {
  position: fixed;
  bottom: var(--space-4);
  right: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  z-index: 1100;
}

.toast {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-4);
  background-color: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  animation: slideIn var(--duration-normal) var(--ease-out);
  min-width: 250px;
  max-width: 400px;
}

.icon {
  font-size: var(--text-lg);
}

.message {
  flex: 1;
  font-size: var(--text-sm);
}

.dismiss {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: var(--text-lg);
  padding: 0;
}

/* Type variants */
.info { border-left: 3px solid var(--text-secondary); }
.success { border-left: 3px solid var(--text-positive); }
.warning { border-left: 3px solid #ffaa00; }
.error { border-left: 3px solid var(--text-negative); }

.info .icon { color: var(--text-secondary); }
.success .icon { color: var(--text-positive); }
.warning .icon { color: #ffaa00; }
.error .icon { color: var(--text-negative); }

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
```

### Usage in App.tsx
```tsx
import { ToastProvider } from './components/ui/ToastProvider'

function App() {
  return (
    <ToastProvider>
      <Router>...</Router>
    </ToastProvider>
  )
}
```

## Testing Requirements

Create `src/components/ui/Toast.test.tsx`:

```typescript
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest'
import { render, screen, fireEvent, act } from '@testing-library/react'
import { Toast } from './Toast'
import { ToastProvider, useToast } from './ToastProvider'

describe('Toast', () => {
  const defaultProps = {
    id: 'test-toast',
    message: 'Test message',
    type: 'info' as const,
    onDismiss: vi.fn(),
  }

  beforeEach(() => {
    vi.clearAllMocks()
  })

  it('renders message', () => {
    render(<Toast {...defaultProps} />)
    expect(screen.getByText('Test message')).toBeInTheDocument()
  })

  it('renders correct icon for info type', () => {
    render(<Toast {...defaultProps} type="info" />)
    expect(screen.getByText('ℹ')).toBeInTheDocument()
  })

  it('renders correct icon for success type', () => {
    render(<Toast {...defaultProps} type="success" />)
    expect(screen.getByText('✓')).toBeInTheDocument()
  })

  it('renders correct icon for warning type', () => {
    render(<Toast {...defaultProps} type="warning" />)
    expect(screen.getByText('⚠')).toBeInTheDocument()
  })

  it('renders correct icon for error type', () => {
    render(<Toast {...defaultProps} type="error" />)
    expect(screen.getByText('✕')).toBeInTheDocument()
  })

  it('calls onDismiss with id when dismiss clicked', () => {
    render(<Toast {...defaultProps} />)
    fireEvent.click(screen.getByText('×'))
    expect(defaultProps.onDismiss).toHaveBeenCalledWith('test-toast')
  })

  it('applies correct class for type', () => {
    const { container } = render(<Toast {...defaultProps} type="error" />)
    expect(container.firstChild).toHaveClass('error')
  })
})

describe('ToastProvider', () => {
  beforeEach(() => {
    vi.useFakeTimers()
  })

  afterEach(() => {
    vi.useRealTimers()
  })

  // Helper component to trigger toasts
  function ToastTrigger({ type = 'info', duration }: { type?: 'info' | 'success' | 'warning' | 'error', duration?: number }) {
    const { toast } = useToast()
    return <button onClick={() => toast('Test toast', type, duration)}>Show Toast</button>
  }

  it('shows toast when triggered', () => {
    render(
      <ToastProvider>
        <ToastTrigger />
      </ToastProvider>
    )
    fireEvent.click(screen.getByText('Show Toast'))
    expect(screen.getByText('Test toast')).toBeInTheDocument()
  })

  it('auto-dismisses after duration', () => {
    render(
      <ToastProvider>
        <ToastTrigger duration={3000} />
      </ToastProvider>
    )
    fireEvent.click(screen.getByText('Show Toast'))
    expect(screen.getByText('Test toast')).toBeInTheDocument()

    act(() => {
      vi.advanceTimersByTime(3000)
    })

    expect(screen.queryByText('Test toast')).not.toBeInTheDocument()
  })

  it('stacks multiple toasts', () => {
    render(
      <ToastProvider>
        <ToastTrigger />
      </ToastProvider>
    )
    fireEvent.click(screen.getByText('Show Toast'))
    fireEvent.click(screen.getByText('Show Toast'))

    const toasts = screen.getAllByText('Test toast')
    expect(toasts).toHaveLength(2)
  })

  it('removes toast when dismissed', () => {
    render(
      <ToastProvider>
        <ToastTrigger duration={0} />
      </ToastProvider>
    )
    fireEvent.click(screen.getByText('Show Toast'))
    fireEvent.click(screen.getByText('×'))

    expect(screen.queryByText('Test toast')).not.toBeInTheDocument()
  })
})
```

**Minimum test coverage:**
- All 4 toast types render with correct styling
- Auto-dismiss after duration
- Manual dismiss works
- Multiple toasts stack
- useToast hook works correctly

## Verification

```bash
npm run test -- --grep "Toast"

# Manual verification:
# - Trigger toasts of each type
# - Verify auto-dismiss after 5s
# - Click dismiss button
# - Trigger multiple toasts, verify stacking
```

## Reference

- [Components Spec - Toast](../../../ui/components.md#toast)
