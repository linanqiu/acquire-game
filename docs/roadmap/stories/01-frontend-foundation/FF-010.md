# FF-010: Routing Setup

## Metadata
- **Epic**: Frontend Foundation
- **Status**: `not-started`
- **Priority**: `high`
- **Effort**: `S` (30-60 minutes)
- **Dependencies**: FF-001

## Context

Set up React Router with the three main routes: Lobby (/), Player View (/play/:room), and Host View (/host/:room). Include 404 handling and route guards.

## Requirements

1. Install and configure React Router v6
2. Define routes for lobby, player, and host views
3. Extract room code from URL params
4. 404 page for unknown routes
5. Redirect logic if needed

## Acceptance Criteria

- [ ] `/` renders Lobby page
- [ ] `/play/:room` renders Player View with room param
- [ ] `/host/:room` renders Host View with room param
- [ ] Unknown routes show 404 page
- [ ] Room code extracted from URL is accessible
- [ ] Navigation works without page reload
- [ ] Browser back/forward works correctly

## Implementation Notes

### Install React Router
```bash
cd frontend
npm install react-router-dom
```

### File to Create/Modify

**frontend/src/App.tsx**:
```tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import { LobbyPage } from './pages/LobbyPage'
import { PlayerPage } from './pages/PlayerPage'
import { HostPage } from './pages/HostPage'
import { NotFoundPage } from './pages/NotFoundPage'

export function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<LobbyPage />} />
        <Route path="/play/:room" element={<PlayerPage />} />
        <Route path="/host/:room" element={<HostPage />} />
        <Route path="*" element={<NotFoundPage />} />
      </Routes>
    </BrowserRouter>
  )
}
```

> **Note**: ToastProvider (from FF-009) should wrap the Routes once available.

**frontend/src/pages/LobbyPage.tsx** (placeholder):
```tsx
export function LobbyPage() {
  return <div>Lobby Page - Coming in GU-001</div>
}
```

**frontend/src/pages/PlayerPage.tsx** (placeholder):
```tsx
import { useParams } from 'react-router-dom'

export function PlayerPage() {
  const { room } = useParams<{ room: string }>()
  return <div>Player View - Room: {room}</div>
}
```

**frontend/src/pages/HostPage.tsx** (placeholder):
```tsx
import { useParams } from 'react-router-dom'

export function HostPage() {
  const { room } = useParams<{ room: string }>()
  return <div>Host View - Room: {room}</div>
}
```

**frontend/src/pages/NotFoundPage.tsx**:
```tsx
import { Link } from 'react-router-dom'
import { PageShell } from '../components/ui/PageShell'
import { Button } from '../components/ui/Button'

export function NotFoundPage() {
  return (
    <PageShell>
      <div style={{ textAlign: 'center', padding: '4rem' }}>
        <h1>404</h1>
        <p>Page not found</p>
        <Link to="/">
          <Button>Back to Lobby</Button>
        </Link>
      </div>
    </PageShell>
  )
}
```

**frontend/src/pages/index.ts**:
```tsx
export { LobbyPage } from './LobbyPage'
export { PlayerPage } from './PlayerPage'
export { HostPage } from './HostPage'
export { NotFoundPage } from './NotFoundPage'
```

### Custom Hook for Room
```tsx
// frontend/src/hooks/useRoom.ts
import { useParams } from 'react-router-dom'

export function useRoom() {
  const { room } = useParams<{ room: string }>()
  return room?.toUpperCase() ?? ''
}
```

## Testing Requirements

Create routing tests:

**src/App.test.tsx**:
```typescript
import { describe, it, expect } from 'vitest'
import { render, screen } from '@testing-library/react'
import { MemoryRouter } from 'react-router-dom'
import { App } from './App'

// Helper to render with specific route
function renderWithRoute(route: string) {
  return render(
    <MemoryRouter initialEntries={[route]}>
      <App />
    </MemoryRouter>
  )
}

describe('App Routing', () => {
  it('renders lobby page at /', () => {
    renderWithRoute('/')
    expect(screen.getByText(/Lobby/i)).toBeInTheDocument()
  })

  it('renders player view at /play/:room', () => {
    renderWithRoute('/play/ABCD')
    expect(screen.getByText(/Player View/i)).toBeInTheDocument()
    expect(screen.getByText(/ABCD/i)).toBeInTheDocument()
  })

  it('renders host view at /host/:room', () => {
    renderWithRoute('/host/WXYZ')
    expect(screen.getByText(/Host View/i)).toBeInTheDocument()
    expect(screen.getByText(/WXYZ/i)).toBeInTheDocument()
  })

  it('renders 404 for unknown routes', () => {
    renderWithRoute('/unknown/path')
    expect(screen.getByText(/404/i)).toBeInTheDocument()
  })

  it('extracts room code from URL in uppercase', () => {
    renderWithRoute('/play/abcd')
    // Room code should be uppercased
    expect(screen.getByText(/ABCD/i)).toBeInTheDocument()
  })
})
```

**src/hooks/useRoom.test.ts**:
```typescript
import { describe, it, expect } from 'vitest'
import { renderHook } from '@testing-library/react'
import { MemoryRouter, Route, Routes } from 'react-router-dom'
import { useRoom } from './useRoom'

function wrapper({ children, route }: { children: React.ReactNode, route: string }) {
  return (
    <MemoryRouter initialEntries={[route]}>
      <Routes>
        <Route path="/play/:room" element={children} />
      </Routes>
    </MemoryRouter>
  )
}

describe('useRoom', () => {
  it('returns room code from URL', () => {
    const { result } = renderHook(() => useRoom(), {
      wrapper: ({ children }) => wrapper({ children, route: '/play/ABCD' }),
    })
    expect(result.current).toBe('ABCD')
  })

  it('returns uppercase room code', () => {
    const { result } = renderHook(() => useRoom(), {
      wrapper: ({ children }) => wrapper({ children, route: '/play/abcd' }),
    })
    expect(result.current).toBe('ABCD')
  })

  it('returns empty string when no room param', () => {
    const { result } = renderHook(() => useRoom(), {
      wrapper: ({ children }) => (
        <MemoryRouter initialEntries={['/']}>
          <Routes>
            <Route path="/" element={children} />
          </Routes>
        </MemoryRouter>
      ),
    })
    expect(result.current).toBe('')
  })
})
```

**Minimum test coverage:**
- All routes render correct components
- Room code extracted from URL params
- 404 page for unknown routes
- useRoom hook returns correct values

## Verification

```bash
npm run test -- --grep "Routing\|useRoom"
npm run dev

# Test each route:
# - http://localhost:5173/
# - http://localhost:5173/play/ABCD
# - http://localhost:5173/host/ABCD
# - http://localhost:5173/invalid (should show 404)

# Test browser navigation:
# - Navigate between pages
# - Use back/forward buttons
```

## Reference

- [Storyboard - Page Inventory](../../../ui/storyboard.md#page-inventory)
- [React Router Docs](https://reactrouter.com/)
