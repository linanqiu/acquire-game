# FF-001: Project Setup

## Metadata
- **Epic**: Frontend Foundation
- **Status**: `not-started`
- **Priority**: `critical`
- **Effort**: `M` (1-2 hours)
- **Dependencies**: None

## Context

This is the foundational story that enables all frontend development. We need a modern React + TypeScript setup with Vite for fast development, proper testing infrastructure, and the folder structure for the design system.

## Requirements

1. Initialize Vite project with React + TypeScript template
2. Configure project structure for scalability
3. Set up testing with Vitest and Playwright
4. Configure ESLint and Prettier
5. Add npm scripts for dev, build, test, lint, format

## Acceptance Criteria

- [ ] `npm run dev` starts development server on port 5173
- [ ] `npm run build` produces production bundle in `dist/`
- [ ] `npm run test` runs Vitest unit tests
- [ ] `npm run e2e` runs Playwright tests
- [ ] `npm run lint` checks code with ESLint
- [ ] `npm run format` formats code with Prettier
- [ ] TypeScript strict mode enabled
- [ ] Project structure follows convention below

## Implementation Notes

### Project Structure
```
frontend/
├── src/
│   ├── components/       # Reusable UI components
│   │   ├── ui/           # Design system primitives
│   │   └── game/         # Game-specific components
│   ├── pages/            # Route pages
│   ├── hooks/            # Custom React hooks
│   ├── stores/           # Zustand stores
│   ├── lib/              # Utilities, WebSocket client
│   ├── styles/           # Global styles, CSS variables
│   ├── types/            # TypeScript types
│   ├── App.tsx
│   └── main.tsx
├── tests/
│   ├── unit/             # Vitest tests
│   └── e2e/              # Playwright tests
├── public/
├── index.html
├── vite.config.ts
├── tsconfig.json
├── playwright.config.ts
├── .eslintrc.cjs
├── .prettierrc
└── package.json
```

### Commands to Run
```bash
cd /home/linan/acquire
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install
npm install -D vitest @testing-library/react @testing-library/jest-dom jsdom
npm install -D @playwright/test
npm install -D eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser
npm install -D prettier eslint-config-prettier
npx playwright install
```

### Key Configuration

**vite.config.ts**:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './tests/setup.ts',
  },
  server: {
    proxy: {
      '/api': 'http://localhost:8000',
      '/ws': {
        target: 'ws://localhost:8000',
        ws: true,
      },
    },
  },
})
```

## Testing Standards

This story establishes the testing foundation for all frontend work. All subsequent stories must follow these standards.

### Coverage Requirements

- **Target**: >80% coverage for `src/components/`, `src/hooks/`, `src/lib/`
- **Measurement**: `npm run test -- --coverage`
- **CI enforcement**: Coverage reports uploaded to Codecov

### Test File Naming Convention

```
src/
├── components/
│   └── ui/
│       ├── Button.tsx
│       └── Button.test.tsx      # Collocated unit test
├── hooks/
│   ├── useRoom.ts
│   └── useRoom.test.ts          # Collocated unit test
├── lib/
│   ├── websocket.ts
│   └── websocket.test.ts        # Collocated unit test
tests/
├── unit/
│   └── setup.ts                 # Vitest setup file
├── e2e/
│   └── *.spec.ts                # Playwright E2E tests
└── fixtures/
    └── gameState.ts             # Shared test fixtures
```

### Component Test Requirements

Every component must have tests covering:
1. **Rendering**: Component renders without crashing
2. **Props**: All props work as documented
3. **Variants/States**: All visual variants render correctly
4. **Interactions**: Click, keyboard, and focus behaviors
5. **Edge cases**: Empty states, error states, loading states

### WebSocket Mock Utilities

Create mock utilities for WebSocket testing:

**tests/mocks/websocket.ts**:
```typescript
import { vi } from 'vitest'

export class MockWebSocket {
  static instances: MockWebSocket[] = []

  onopen: (() => void) | null = null
  onclose: (() => void) | null = null
  onmessage: ((event: { data: string }) => void) | null = null
  onerror: ((error: Event) => void) | null = null
  readyState = WebSocket.CONNECTING

  constructor(public url: string) {
    MockWebSocket.instances.push(this)
  }

  send = vi.fn()
  close = vi.fn()

  // Test helpers
  simulateOpen() {
    this.readyState = WebSocket.OPEN
    this.onopen?.()
  }

  simulateMessage(data: unknown) {
    this.onmessage?.({ data: JSON.stringify(data) })
  }

  simulateClose() {
    this.readyState = WebSocket.CLOSED
    this.onclose?.()
  }

  simulateError(error: Event) {
    this.onerror?.(error)
  }

  static reset() {
    MockWebSocket.instances = []
  }
}

// Mock global WebSocket
vi.stubGlobal('WebSocket', MockWebSocket)
```

### Test Data Fixtures

Create shared fixtures for consistent test data:

**tests/fixtures/gameState.ts**:
```typescript
import type { GameState, Player, Board } from '@/types'

export const createMockPlayer = (overrides?: Partial<Player>): Player => ({
  id: 'player-1',
  name: 'Test Player',
  cash: 6000,
  stocks: { luxor: 0, tower: 0, american: 0, festival: 0, worldwide: 0, continental: 0, imperial: 0 },
  tiles: ['1A', '2B', '3C'],
  ...overrides,
})

export const createMockGameState = (overrides?: Partial<GameState>): GameState => ({
  phase: 'place_tile',
  currentPlayer: 0,
  players: [createMockPlayer()],
  board: createEmptyBoard(),
  chains: {},
  tilePool: 100,
  ...overrides,
})

export const createEmptyBoard = (): Board => {
  // 12x9 grid
  const board: Board = {}
  for (let row = 1; row <= 9; row++) {
    for (let col = 'A'; col <= 'L'; col = String.fromCharCode(col.charCodeAt(0) + 1)) {
      board[`${row}${col}`] = null
    }
  }
  return board
}

// Seeded random for deterministic tests
export const seededRandom = (seed: number) => {
  return () => {
    seed = (seed * 1103515245 + 12345) & 0x7fffffff
    return seed / 0x7fffffff
  }
}
```

### Vitest Configuration

**vite.config.ts** (updated):
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './tests/unit/setup.ts',
    include: ['src/**/*.test.{ts,tsx}', 'tests/unit/**/*.test.{ts,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      include: ['src/components/**', 'src/hooks/**', 'src/lib/**'],
      exclude: ['**/*.test.{ts,tsx}', '**/index.ts'],
      thresholds: {
        statements: 80,
        branches: 80,
        functions: 80,
        lines: 80,
      },
    },
  },
  server: {
    proxy: {
      '/api': 'http://localhost:8000',
      '/ws': {
        target: 'ws://localhost:8000',
        ws: true,
      },
    },
  },
})
```

**tests/unit/setup.ts**:
```typescript
import '@testing-library/jest-dom'
import { cleanup } from '@testing-library/react'
import { afterEach, vi } from 'vitest'

// Cleanup after each test
afterEach(() => {
  cleanup()
})

// Mock window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation((query) => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
})
```

## Verification

```bash
cd frontend
npm run dev &    # Should start on :5173
npm run build    # Should create dist/
npm run test     # Should pass (empty test suite OK)
npm run test -- --coverage  # Should show coverage report
npm run lint     # Should pass with no errors
npm run format   # Should format files
```
