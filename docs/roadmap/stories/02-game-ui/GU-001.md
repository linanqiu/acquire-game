# GU-001: Lobby Page

## Metadata
- **Epic**: Game UI
- **Status**: `not-started`
- **Priority**: `critical`
- **Effort**: `M` (1-2 hours)
- **Dependencies**: FF-005, FF-006, FF-007, FF-010

## Context

The lobby is the entry point for all players. It allows creating new games or joining existing ones via room code. This is the first functional page users will see.

## Requirements

1. Create Game form (name input)
2. Join Game form (name input + room code)
3. Form validation with error display
4. Loading states during submission
5. Redirect to player/host view on success
6. Display game metadata ("3-6 players - ~60 min")

## Acceptance Criteria

- [ ] "Create Game" form with name input
- [ ] "Join Game" form with name and room code inputs
- [ ] Room code auto-capitalizes
- [ ] Validation: name required, max 20 chars
- [ ] Validation: room code 4 characters
- [ ] Loading spinner on button while submitting
- [ ] Error messages display inline
- [ ] Create redirects to `/play/:room?is_host=1`
- [ ] Join redirects to `/play/:room`
- [ ] Responsive layout (mobile + desktop)
- [ ] E2E test: create and join game flow

## Implementation Notes

### File to Create
**frontend/src/pages/LobbyPage.tsx**:

```tsx
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { PageShell } from '../components/ui/PageShell'
import { Card } from '../components/ui/Card'
import { TextInput } from '../components/ui/TextInput'
import { Button } from '../components/ui/Button'
import { useToast } from '../components/ui/ToastProvider'
import styles from './LobbyPage.module.css'

export function LobbyPage() {
  const navigate = useNavigate()
  const { toast } = useToast()

  // Create game state
  const [createName, setCreateName] = useState('')
  const [createLoading, setCreateLoading] = useState(false)
  const [createError, setCreateError] = useState('')

  // Join game state
  const [joinName, setJoinName] = useState('')
  const [joinRoom, setJoinRoom] = useState('')
  const [joinLoading, setJoinLoading] = useState(false)
  const [joinError, setJoinError] = useState('')

  const handleCreate = async () => {
    if (!createName.trim()) {
      setCreateError('Name is required')
      return
    }
    setCreateLoading(true)
    try {
      // Backend expects form data, not JSON
      const formData = new URLSearchParams()
      formData.append('player_name', createName)
      const res = await fetch('/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formData,
      })
      const data = await res.json()
      if (!res.ok) throw new Error(data.detail || 'Failed to create game')
      // Store player_id and session_token for WebSocket auth
      sessionStorage.setItem('player_id', data.player_id)
      sessionStorage.setItem('session_token', data.session_token)
      navigate(`/play/${data.room_code}?is_host=1`)
    } catch (err) {
      setCreateError(err instanceof Error ? err.message : 'Unknown error')
    } finally {
      setCreateLoading(false)
    }
  }

  const handleJoin = async () => {
    if (!joinName.trim()) {
      setJoinError('Name is required')
      return
    }
    if (joinRoom.length !== 4) {
      setJoinError('Room code must be 4 characters')
      return
    }
    setJoinLoading(true)
    try {
      // Backend expects form data, not JSON
      const formData = new URLSearchParams()
      formData.append('player_name', joinName)
      formData.append('room_code', joinRoom)
      const res = await fetch('/join', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formData,
      })
      const data = await res.json()
      if (!res.ok) throw new Error(data.detail || 'Failed to join game')
      // Store player_id and session_token for WebSocket auth
      sessionStorage.setItem('player_id', data.player_id)
      sessionStorage.setItem('session_token', data.session_token)
      navigate(`/play/${data.room_code}`)
    } catch (err) {
      setJoinError(err instanceof Error ? err.message : 'Unknown error')
    } finally {
      setJoinLoading(false)
    }
  }

  return (
    <PageShell>
      <div className={styles.lobby}>
        <h1 className={styles.title}>ACQUIRE</h1>

        <div className={styles.forms}>
          <Card title="CREATE GAME">
            <TextInput
              label="Your Name"
              value={createName}
              onChange={(e) => setCreateName(e.target.value)}
              maxLength={20}
              error={createError}
            />
            <Button
              fullWidth
              loading={createLoading}
              onClick={handleCreate}
            >
              CREATE
            </Button>
          </Card>

          <Card title="JOIN GAME">
            <TextInput
              label="Your Name"
              value={joinName}
              onChange={(e) => setJoinName(e.target.value)}
              maxLength={20}
            />
            <TextInput
              label="Room Code"
              value={joinRoom}
              onChange={(e) => setJoinRoom(e.target.value)}
              maxLength={4}
              autoCapitalize
              error={joinError}
            />
            <Button
              fullWidth
              loading={joinLoading}
              onClick={handleJoin}
            >
              JOIN
            </Button>
          </Card>
        </div>

        <p className={styles.meta}>3-6 players · ~60 min</p>
      </div>
    </PageShell>
  )
}
```

### Layout Reference
```
+------------------------------------------+
|           ACQUIRE                        |
+------------------------------------------+
|  +------------------+ +----------------+ |
|  |  CREATE GAME     | |  JOIN GAME     | |
|  |  [Your Name]     | |  [Your Name]   | |
|  |  [CREATE]        | |  [Room Code]   | |
|  |                  | |  [JOIN]        | |
|  +------------------+ +----------------+ |
|         "3-6 players · ~60 min"          |
+------------------------------------------+
```

## Verification

```bash
npm run test -- --grep "Lobby"
npm run e2e -- --grep "lobby"

# Manual:
# - Fill form, submit, check redirect
# - Test validation errors
# - Test with backend running
```

## Reference

- [Storyboard - Lobby](../../../ui/storyboard.md#screen-1-lobby-)
