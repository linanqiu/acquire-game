# GU-014: Game Over Screen

## Metadata
- **Epic**: Game UI
- **Status**: `not-started`
- **Priority**: `medium`
- **Effort**: `M` (1-2 hours)
- **Dependencies**: GU-006, FF-008

## Context

Final results screen showing winner, rankings, and score breakdown. Displayed after game end declaration and final scoring.

## Requirements

1. Announce winner (or tie)
2. Show final rankings with total money
3. Player view: personal breakdown (cash + bonuses + stock sales)
4. Host view: full table with all player breakdowns
5. Play again / back to lobby buttons

## Acceptance Criteria

- [ ] Winner announced with crown icon
- [ ] Tie game handled (multiple crowns)
- [ ] Rankings 1st through last
- [ ] Total money shown for each player
- [ ] Player view shows personal breakdown
- [ ] Host view shows full breakdown table
- [ ] Note for defunct stock worth $0
- [ ] "Play Again" returns to lobby with same room
- [ ] "Back to Lobby" returns to home page
- [ ] Unit tests for ranking logic

## Implementation Notes

### File to Create

**frontend/src/pages/player/GameOverContent.tsx**:
```tsx
import { useNavigate } from 'react-router-dom'
import { Card } from '../../components/ui/Card'
import { Button } from '../../components/ui/Button'
import { useGameStore } from '../../stores/gameStore'
import styles from './GameOverContent.module.css'

interface FinalScore {
  playerId: string
  name: string
  cash: number
  bonuses: number
  stockSales: number
  total: number
  rank: number
}

export function GameOverContent() {
  const navigate = useNavigate()
  const { finalScores, myPlayerId, room } = useGameStore()

  const sortedScores = [...finalScores].sort((a, b) => b.total - a.total)
  const winners = sortedScores.filter((s) => s.rank === 1)
  const myScore = finalScores.find((s) => s.playerId === myPlayerId)

  const isTie = winners.length > 1

  return (
    <Card title="GAME OVER">
      <div className={styles.winner}>
        {isTie ? (
          <>
            <span className={styles.crown}>ðŸ‘‘ TIE GAME! ðŸ‘‘</span>
            <p>{winners.map((w) => w.name).join(' & ')}: ${winners[0].total.toLocaleString()} each</p>
          </>
        ) : (
          <>
            <span className={styles.crown}>ðŸ‘‘ WINNER: {winners[0].name} ðŸ‘‘</span>
            <p>${winners[0].total.toLocaleString()}</p>
          </>
        )}
      </div>

      <div className={styles.rankings}>
        <h3>FINAL STANDINGS</h3>
        {sortedScores.map((score, idx) => (
          <div
            key={score.playerId}
            className={`${styles.rankRow} ${score.playerId === myPlayerId ? styles.you : ''}`}
          >
            <span className={styles.rank}>
              {score.rank === 1 && 'ðŸ‘‘ '}
              {idx + 1}.
            </span>
            <span className={styles.name}>{score.name}</span>
            <span className={styles.total}>${score.total.toLocaleString()}</span>
          </div>
        ))}
      </div>

      {myScore && (
        <div className={styles.breakdown}>
          <h3>YOUR BREAKDOWN</h3>
          <table>
            <tbody>
              <tr>
                <td>Cash on hand:</td>
                <td>${myScore.cash.toLocaleString()}</td>
              </tr>
              <tr>
                <td>Final bonuses:</td>
                <td>+${myScore.bonuses.toLocaleString()}</td>
              </tr>
              <tr>
                <td>Stock liquidation:</td>
                <td>+${myScore.stockSales.toLocaleString()}</td>
              </tr>
              <tr className={styles.totalRow}>
                <td>TOTAL:</td>
                <td>${myScore.total.toLocaleString()}</td>
              </tr>
            </tbody>
          </table>
        </div>
      )}

      <div className={styles.actions}>
        <Button onClick={() => navigate(`/play/${room}?new_game=1`)}>
          PLAY AGAIN
        </Button>
        <Button variant="secondary" onClick={() => navigate('/')}>
          BACK TO LOBBY
        </Button>
      </div>
    </Card>
  )
}
```

### Layout - Player View
```
+------------------------------------------+
| GAME OVER                                |
+------------------------------------------+
|                                          |
| ðŸ‘‘ WINNER: BOB ($32,200) ðŸ‘‘              |
|                                          |
| FINAL STANDINGS                          |
| ---------------------------------------- |
| ðŸ‘‘ 1. BOB      $32,200                   |
|    2. CAROL    $28,100                   |
|    3. YOU      $24,800                   |
|    4. DAN      $19,500                   |
|                                          |
| YOUR BREAKDOWN                           |
| ---------------------------------------- |
| Cash on hand:        $4,500              |
| Final bonuses:      +$8,300              |
| Stock liquidation: +$12,000              |
| TOTAL:              $24,800              |
|                                          |
| [PLAY AGAIN]      [BACK TO LOBBY]        |
+------------------------------------------+
```

## Verification

```bash
npm run test -- --grep "GameOver"
npm run e2e -- --grep "game-over"
```

## Reference

- [Storyboard - Game Over](../../../ui/storyboard.md#screen-4-game-over)
