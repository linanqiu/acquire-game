# GU-010: Merger Disposition

## Metadata
- **Epic**: Game UI
- **Status**: `not-started`
- **Priority**: `high`
- **Effort**: `L` (2-4 hours)
- **Dependencies**: GU-008, FF-008

## Context

Stock disposition interface during mergers. Players choose how to handle their defunct chain shares: sell, trade (2:1 for survivor shares), or hold. Critical UX for the merger flow.

## Requirements

1. Display defunct chain info and shares owned
2. Sliders for SELL / TRADE / HOLD allocation
3. Trade slider only allows even numbers (2:1 ratio)
4. Real-time calculation of results
5. Show survivor stock availability
6. Confirm button

## Acceptance Criteria

- [ ] Shows defunct chain name and player's share count
- [ ] Shows defunct chain price
- [ ] SELL slider: 0 to shares owned
- [ ] TRADE slider: 0 to shares owned, step=2
- [ ] TRADE disabled if survivor has no stock
- [ ] HOLD = total - sell - trade (auto-calculated)
- [ ] Cash from selling displayed
- [ ] Survivor shares from trading displayed
- [ ] Summary row before confirm
- [ ] Confirm button submits disposition
- [ ] Unit tests for calculations

## Implementation Notes

### File to Create

**frontend/src/components/game/MergerDisposition.tsx**:
```tsx
import { useState, useMemo } from 'react'
import { ChainMarker } from './ChainMarker'
import { Slider } from '../ui/Slider'
import { Button } from '../ui/Button'
import { Card } from '../ui/Card'
import styles from './MergerDisposition.module.css'
import type { ChainName } from '../../types/game'

interface MergerDispositionProps {
  defunctChain: ChainName
  survivorChain: ChainName
  sharesOwned: number
  defunctPrice: number
  survivorStockAvailable: number
  onConfirm: (sell: number, trade: number, hold: number) => void
}

export function MergerDisposition({
  defunctChain,
  survivorChain,
  sharesOwned,
  defunctPrice,
  survivorStockAvailable,
  onConfirm,
}: MergerDispositionProps) {
  const [sellCount, setSellCount] = useState(0)
  const [tradeCount, setTradeCount] = useState(0)

  const maxTrade = Math.min(
    sharesOwned - sellCount,
    survivorStockAvailable * 2 // 2:1 ratio
  )

  const holdCount = sharesOwned - sellCount - tradeCount
  const cashFromSell = sellCount * defunctPrice
  const sharesFromTrade = Math.floor(tradeCount / 2)

  const handleSellChange = (value: number) => {
    setSellCount(value)
    // Adjust trade if needed
    if (tradeCount > sharesOwned - value) {
      setTradeCount(Math.max(0, sharesOwned - value))
    }
  }

  const handleTradeChange = (value: number) => {
    // Ensure even number for 2:1 trade
    setTradeCount(Math.floor(value / 2) * 2)
  }

  return (
    <Card title={`DISPOSE OF YOUR ${defunctChain.toUpperCase()} STOCK`}>
      <div className={styles.info}>
        <p>
          You have: <strong>{sharesOwned}</strong>{' '}
          <ChainMarker chain={defunctChain} variant="compact" /> shares
        </p>
        <p>
          Price at merger: <strong>${defunctPrice.toLocaleString()}</strong>/share
        </p>
        <p>
          <ChainMarker chain={survivorChain} variant="compact" /> stock available:{' '}
          <strong>{survivorStockAvailable}</strong>
        </p>
      </div>

      <div className={styles.sliders}>
        <Slider
          label="SELL to bank"
          value={sellCount}
          min={0}
          max={sharesOwned}
          step={1}
          onChange={handleSellChange}
          displayValue={`${sellCount} shares → $${cashFromSell.toLocaleString()}`}
        />

        <Slider
          label={`TRADE 2:1 for ${survivorChain.toUpperCase()}`}
          value={tradeCount}
          min={0}
          max={maxTrade}
          step={2}
          onChange={handleTradeChange}
          displayValue={`${tradeCount} shares → ${sharesFromTrade} ${survivorChain.toUpperCase()}`}
          disabled={survivorStockAvailable === 0}
        />

        <div className={styles.hold}>
          <span className={styles.holdLabel}>HOLD (keep for re-founding)</span>
          <span className={styles.holdValue}>
            {holdCount} shares (worth $0 until re-founded)
          </span>
        </div>
      </div>

      <div className={styles.summary}>
        <strong>SUMMARY:</strong>{' '}
        SELL {sellCount} (+${cashFromSell.toLocaleString()}) |{' '}
        TRADE {tradeCount} (+{sharesFromTrade} {survivorChain.toUpperCase()}) |{' '}
        HOLD {holdCount}
      </div>

      <Button
        fullWidth
        onClick={() => onConfirm(sellCount, tradeCount, holdCount)}
      >
        CONFIRM DISPOSITION
      </Button>
    </Card>
  )
}
```

### Layout
```
+------------------------------------------+
| DISPOSE OF YOUR LUXOR STOCK              |
+------------------------------------------+
| You have: 3 LUXOR shares                 |
| LUXOR price at merger: $500/share        |
| AMERICAN (survivor) stock available: 15  |
|                                          |
| SELL to bank                             |
| [----------*-----] 2 shares → $1,000     |
|                                          |
| TRADE 2:1 for AMERICAN                   |
| [--*--------------] 0 shares → 0 AME     |
|                                          |
| HOLD (keep for re-founding)              |
| 1 share (worth $0 until re-founded)      |
+------------------------------------------+
| SUMMARY: SELL 2 (+$1,000) | HOLD 1       |
|                                          |
| [CONFIRM DISPOSITION]                    |
+------------------------------------------+
```

## Verification

```bash
npm run test -- --grep "MergerDisposition"

# E2E test: complete a merger flow
npm run e2e -- --grep "merger"
```

## Reference

- [Storyboard - Merger Disposition](../../../ui/storyboard.md#step-3-stock-disposition-your-turn)
- [Components Spec - MergerDisposition](../../../ui/components.md#mergerdisposition)
