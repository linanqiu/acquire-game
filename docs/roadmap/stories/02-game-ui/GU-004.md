# GU-004: Tile Rack

## Metadata
- **Epic**: Game UI
- **Status**: `complete`
- **Priority**: `critical`
- **Effort**: `M` (1-2 hours)
- **Dependencies**: GU-003

## Context

The player's hand of 6 tiles, displayed at the bottom of the player view. Each tile shows its coordinate and playability status. This is the primary interaction point during the tile placement phase.

## Requirements

1. Display 6 tiles in a horizontal row
2. Show playability indicators on each tile
3. Support tile selection
4. Handle different playability states
5. Bottom-anchored positioning for mobile (thumb-friendly)

## Acceptance Criteria

- [x] Renders exactly 6 tiles
- [x] Selected tile has visual emphasis
- [x] Playable tiles: normal appearance
- [x] Merger tiles: warning indicator (!!)
- [x] Temporarily unplayable: dimmed with lock
- [x] Permanently unplayable: crossed out
- [x] Clicking a playable tile triggers onTileSelect
- [x] Clicking disabled tile does nothing
- [x] Disabled prop disables all interaction
- [x] Responsive: works on mobile widths
- [x] Unit tests for all states

## Implementation Notes

### File to Create

**frontend/src/components/game/TileRack.tsx**:
```tsx
import { Tile } from './Tile'
import styles from './TileRack.module.css'
import type { Coordinate } from '../../types/game'

type Playability = 'playable' | 'merger' | 'temp_unplayable' | 'perm_unplayable'

interface RackTile {
  coordinate: Coordinate
  playability: Playability
}

interface TileRackProps {
  tiles: RackTile[]
  selectedTile?: Coordinate
  onTileSelect: (coord: Coordinate) => void
  disabled?: boolean
}

function playabilityToState(
  playability: Playability,
  isSelected: boolean
): 'default' | 'selected' | 'disabled' | 'merger' | 'dead' {
  if (isSelected) return 'selected'
  switch (playability) {
    case 'playable': return 'default'
    case 'merger': return 'merger'
    case 'temp_unplayable': return 'disabled'
    case 'perm_unplayable': return 'dead'
  }
}

export function TileRack({
  tiles,
  selectedTile,
  onTileSelect,
  disabled = false,
}: TileRackProps) {
  return (
    <div className={styles.rack}>
      {tiles.map((tile) => {
        const isSelected = selectedTile === tile.coordinate
        const canInteract =
          !disabled &&
          (tile.playability === 'playable' || tile.playability === 'merger')

        return (
          <Tile
            key={tile.coordinate}
            coordinate={tile.coordinate}
            state={playabilityToState(tile.playability, isSelected)}
            onClick={canInteract ? () => onTileSelect(tile.coordinate) : undefined}
            size="lg"
            showLabel={true}
          />
        )
      })}
    </div>
  )
}
```

**frontend/src/components/game/TileRack.module.css**:
```css
.rack {
  display: flex;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-3);
  background-color: var(--bg-secondary);
  border-top: 1px solid var(--border);
}

/* Responsive: ensure tiles fit on small screens */
@media (max-width: 400px) {
  .rack {
    gap: var(--space-1);
  }
}
```

### Playability States

| State | Visual | Interaction |
|-------|--------|-------------|
| `playable` | Normal | Clickable |
| `merger` | Yellow border, !! | Clickable (shows merger preview) |
| `temp_unplayable` | Dimmed, lock | Not clickable |
| `perm_unplayable` | Crossed out | Not clickable, offer replacement |

### Layout
```
+-----+ +-----+ +-----+ +-----+ +-----+ +-----+
| 1A  | | 3C  | | 6D  | | 7G  | | 9B  | |12I |
|     | | !!  | | *   | |     | | ðŸ”’  | | âœ•  |
+-----+ +-----+ +-----+ +-----+ +-----+ +-----+
```

## Verification

```bash
npm run test -- --grep "TileRack"

# Visual: render with various tile states
npm run dev
```

## Integration Notes for RT-002

**Backend/Frontend Playability Mismatch**: The backend returns playability in a different format than the frontend expects.

**Backend format** (`Rules.get_tile_playability`):
```python
{
    "playable": bool,
    "reason": "would_merge_safe_chains" | "eighth_chain" | None,
    "permanent": bool | None
}
```

**Frontend format** (`Playability` type):
```typescript
type Playability = 'playable' | 'merger' | 'temp_unplayable' | 'perm_unplayable'
```

**Transformation function needed in RT-002 game store**:
```typescript
function backendPlayabilityToFrontend(
  playability: { playable: boolean; reason: string | null; permanent: boolean | null },
  wouldTriggerMerger: boolean  // Must be computed from board state
): Playability {
  if (!playability.playable) {
    return playability.permanent ? 'perm_unplayable' : 'temp_unplayable'
  }
  return wouldTriggerMerger ? 'merger' : 'playable'
}
```

**Note**: The backend does NOT flag merger scenariosâ€”it just returns `playable: true`. The frontend must detect mergers by checking if the tile has 2+ adjacent chains. This logic should be added to the game store when integrating.

## Reference

- [Components Spec - TileRack](../../../ui/components.md#tilerack)
- [Storyboard - Tile Rack States](../../../ui/storyboard.md#tile-rack-states)
