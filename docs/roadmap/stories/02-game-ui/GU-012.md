# GU-012: Player View Shell

## Metadata
- **Epic**: Game UI
- **Status**: `complete`
- **Priority**: `critical`
- **Effort**: `L` (2-4 hours)
- **Dependencies**: GU-004, GU-007, FF-005, RT-002

## Context

The main player view page shell that orchestrates all game phases. This is the mobile-first private view each player sees on their phone. It must handle all game states and phase transitions.

## Requirements

1. Header with player info, room code, cash, tile pool
2. Phase indicator showing current phase
3. Context-sensitive main content based on game phase
4. Portfolio strip showing stocks
5. Bottom-anchored tile rack
6. Handle all game phases from lobby to game over

## Acceptance Criteria

- [x] Header shows player name, room code, cash, tile pool status
- [x] Phase indicator updates for each phase
- [x] Pre-game lobby state shows player list
- [x] Trading phase shows trade UI (via TradeBuilder modal)
- [x] Tile placement phase shows board with tile selection
- [x] Chain founding shows chain selector
- [x] Merger shows disposition interface (when your turn)
- [x] Stock buying shows cart interface
- [x] Game over shows final scores
- [x] Portfolio strip always visible during game
- [x] Tile rack bottom-anchored during game
- [x] Responsive on mobile (375px+)
- [ ] E2E test: complete game flow (pending RT-002 integration)

## Implementation Notes

### File to Create

**frontend/src/pages/PlayerPage.tsx**:
```tsx
import { useParams } from 'react-router-dom'
import { PageShell } from '../components/ui/PageShell'
import { TileRack } from '../components/game/TileRack'
import { Portfolio } from '../components/game/Portfolio'
import { useGameStore } from '../stores/gameStore'
import { useRoom } from '../hooks/useRoom'

// Phase-specific components
import { LobbyContent } from './player/LobbyContent'
import { TradingContent } from './player/TradingContent'
import { TilePlacementContent } from './player/TilePlacementContent'
import { ChainFoundingContent } from './player/ChainFoundingContent'
import { MergerContent } from './player/MergerContent'
import { StockBuyingContent } from './player/StockBuyingContent'
import { WaitingContent } from './player/WaitingContent'
import { GameOverContent } from './player/GameOverContent'

import styles from './PlayerPage.module.css'

export function PlayerPage() {
  const room = useRoom()
  const {
    phase,
    isMyTurn,
    myPlayer,
    myTiles,
    chainPrices,
    tilePool,
    selectTile,
    selectedTile,
  } = useGameStore()

  const getPhaseIndicator = () => {
    if (phase === 'lobby') return 'WAITING FOR HOST'
    if (phase === 'game_over') return 'GAME OVER'
    if (!isMyTurn) return `${currentPlayerName}'s TURN`

    switch (phase) {
      case 'trading': return 'PHASE 1: TRADES'
      case 'tile_placement': return 'PHASE 2: PLACE TILE'
      case 'founding': return 'CHOOSE A CHAIN'
      case 'merging': return 'MERGER: DISPOSE STOCK'
      case 'buying': return 'PHASE 3: BUY STOCKS'
      default: return phase.toUpperCase()
    }
  }

  const renderContent = () => {
    if (phase === 'lobby') return <LobbyContent />
    if (phase === 'game_over') return <GameOverContent />
    if (!isMyTurn && phase !== 'merging') return <WaitingContent />

    switch (phase) {
      case 'trading': return <TradingContent />
      case 'tile_placement': return <TilePlacementContent />
      case 'founding': return <ChainFoundingContent />
      case 'merging': return <MergerContent />
      case 'buying': return <StockBuyingContent />
      default: return <WaitingContent />
    }
  }

  const showTileRack = phase !== 'lobby' && phase !== 'game_over'
  const showPortfolio = phase !== 'lobby' && phase !== 'game_over'

  return (
    <PageShell
      phase={getPhaseIndicator()}
      footer={
        showTileRack && (
          <TileRack
            tiles={myTiles}
            selectedTile={selectedTile}
            onTileSelect={selectTile}
            disabled={phase !== 'tile_placement' || !isMyTurn}
          />
        )
      }
    >
      <div className={styles.content}>
        {renderContent()}
      </div>

      {showPortfolio && (
        <div className={styles.portfolioStrip}>
          <Portfolio
            holdings={myPlayer?.stocks || []}
            prices={chainPrices}
            showTotal={false}
          />
        </div>
      )}
    </PageShell>
  )
}
```

### Phase Content Components
Each phase gets its own component in `frontend/src/pages/player/`:
- `LobbyContent.tsx` - Player list, waiting for start
- `TradingContent.tsx` - Trade UI or skip button
- `TilePlacementContent.tsx` - Board with preview
- `ChainFoundingContent.tsx` - Chain selector modal
- `MergerContent.tsx` - Disposition or waiting queue
- `StockBuyingContent.tsx` - Purchase cart
- `WaitingContent.tsx` - Watch mode for other's turn
- `GameOverContent.tsx` - Final scores

## Verification

```bash
npm run test -- --grep "PlayerPage"
npm run e2e -- --grep "player-view"

# Manual: test all game phases
npm run dev
```

## Reference

- [Storyboard - Player View](../../../ui/storyboard.md#screen-2-player-view-playroom)
