# BL-005: Frontend Simplification

## Metadata
- **Epic**: Backlog
- **Status**: `not-started`
- **Priority**: `low`
- **Effort**: `L` (2-4 hours)
- **Dependencies**: None

## Context

The frontend has grown to ~4,920 lines across 29 components. While the component count is reasonable for a multiplayer board game, there are structural issues causing unnecessary complexity:

1. **PlayerPage.tsx is 622 lines** handling 7 different game phases
2. **Duplicate code** across files (phase text, score transformation)
3. **Over-engineered components** (ReconnectionOverlay with 4 useEffects)
4. **Trivial abstractions** that add indirection without value

The goal is not fewer components, but better-balanced ones where each file does one thing.

## Requirements

### Split PlayerPage into Phase Components

Extract each game phase into its own component:

```
pages/
  GamePage.tsx           (~100 lines - phase routing only)

phases/
  LobbyPhase.tsx         (~80 lines)
  TilePlacementPhase.tsx (~80 lines)
  FoundingPhase.tsx      (~60 lines)
  MergerPhase.tsx        (~100 lines)
  BuyingPhase.tsx        (~80 lines)
  GameOverPhase.tsx      (~80 lines)
```

### Extract Shared Utilities

- `getPhaseText()` - duplicated in PlayerPage and HostPage
- `buildGameOverScores()` - duplicated score transformation logic
- `useGameDerivedState()` - consolidate 8 useMemo calls into one hook

### Simplify Over-engineered Components

**ReconnectionOverlay** (202 lines → ~80 lines):
- Current: useReducer + 4 useEffect + 2 useRef + race condition handling
- Target: Simple useState + single useEffect with cleanup

**TradeBuilder** dual-state problem:
- Current: Stores both `offerCashInput` (string) AND `offer.cash` (number)
- Target: Single state, parse on submit

### Remove Trivial Abstractions

- `useRoom()` hook (6 lines) - inline into components
- Consider inlining `transforms.ts` utilities used only once

## Acceptance Criteria

- [ ] PlayerPage.tsx reduced to <150 lines (phase routing only)
- [ ] Each phase component is <120 lines
- [ ] No duplicate getPhaseText() implementations
- [ ] No duplicate score transformation logic
- [ ] ReconnectionOverlay uses ≤2 useEffect hooks
- [ ] TradeBuilder has single source of truth for state
- [ ] All existing tests pass
- [ ] No functionality changes - pure refactor

## Implementation Notes

### Phase 1: Extract Phase Components (biggest win)

1. Create `frontend/src/phases/` directory
2. Extract each render function from PlayerPage into its own component
3. Pass only needed props (not entire gameState)
4. Keep PlayerPage as thin routing layer

### Phase 2: Shared Utilities

1. Create `lib/gameUtils.ts` for shared functions
2. Extract `getPhaseText()` from both pages
3. Extract score transformation logic
4. Create `useGameDerivedState()` hook

### Phase 3: Simplify Components

1. Refactor ReconnectionOverlay to simpler state model
2. Fix TradeBuilder dual-state issue
3. Inline or remove trivial abstractions

## Verification

```bash
# After implementation:
cd frontend

# All tests should pass
npm test

# Run E2E tests to verify no regressions
npm run test:e2e

# Manual verification:
# - Play through all game phases
# - Verify reconnection still works
# - Verify trade proposal still works
```

## Estimated Impact

| Change | Lines Affected | Clarity Gain |
|--------|----------------|--------------|
| Split PlayerPage | ~500 lines reorganized | High |
| Extract utilities | ~80 lines deduplicated | Medium |
| Simplify ReconnectionOverlay | ~120 lines reduced | Medium |
| Fix TradeBuilder | ~30 lines simplified | Low |
| Remove trivial hooks | ~10 lines removed | Low |
